硬件介绍 
================

持续更新中...

简介
----------------
Sentry-小哨兵视觉传感器采用先进的64位RISC-V神经网络处理器K210开发设计，集成多种先进的离线视觉处理算法，可以满足基本的视觉处理需求

应用领域:智能机器人、智能小车、创意设计、STEAM教育、创客比赛、智能玩具

硬件参数
----------------

================    ================    ================    ================    ================    ================
项目                 单位                 最小值               典型值               最大值               备注
================    ================    ================    ================    ================    ================
工作电压              V                   3.3                 5.0                 5.0                 
工作电流              mA                  100                 170                 
尺寸                 mm                                      40×32×12                                含散热片高度
重量                 g                                       15
定位孔间距            mm                                      32
定位孔直径            mm                                      3      
摄像头类型            NA                                      CMOS
摄像头分辨率          像素                 320×240             320×240             2592×1944
摄像头帧率            fps                 25                  50                  100
镜头视场角            度°                                      84                  
镜头焦距              mm                                      2.1     
屏幕类型              NA                                      TFT-ISP                                  
屏幕尺寸              英寸                                     1.3                                     
屏幕分辨率            像素                                     240×240                                  
================    ================    ================    ================    ================    ================

接口定义
----------------

================    ================    ================
引脚序号              UART模式            I2C模式          
================    ================    ================
1                   TX                  SCL
2                   RX                  SDA
3                   GND                 GND
4                   VCC                 VCC
================    ================    ================

算法列表
----------------
================    ================    ================    ================
算法ID               名称                 英文名称             简介
================    ================    ================    ================
1                    颜色识别             Color               设置1～25个识别区域，返回每个区域中的颜色信息，如R，G，B值及分类标签
2                    色块检测             Blob                检测图像中是否包含一个或多个指定颜色的色块，返回其坐标和尺寸，可以通过设置色块尺寸用于滤除干扰
4                    线条检测             Line                检测图像中的实心线条，返回线段的两个端点坐标及倾斜角度，曲线将被近似为直线段处理，可支持5个线段检测
6                    卡片识别             Card                识别特制的卡片图案，共有4类55张卡片，为10张交通卡片，9张形状卡片，10张数字卡片，26张字母卡片
7                    人脸识别             Face                检测与识别人脸，可以通过短按导航键来记录人脸数据，已记录的人脸将会分配一个Label标签用于分类
8                    20类物体识别         20Class              实现对20类常见物体的识别，诸如猫、椅子、人、汽车、电视等
9                    二维码识别           QrCode               识别简单的二维码，可自定义生成，但应符合以下条件：由基本ASCII码字符组成，不超过25个字符，白底黑格图案
11                   移动物体检测         Motion               判断图像中是否有移动区域，如果有，返回该区域的坐标和大小，传感器需处于静止状态，自身不可移动
================    ================    ================    ================


如何使用
----------------
Sentry传感器支持屏幕操作和通讯操作

视觉传感器通过内部寄存器进行状态与参数的交互通讯，支持UART和I2C通讯方式。视觉传感器的使用分为3个步骤：硬件设置、算法设置、结果读取。

硬件设置
****************
用于配置硬件相关的参数，比如摄像头参数，串口波特率等信息，设置后会自动保存，下次启动时不必再次设置。
但如果忘记了当前的参数状态，可以在每次开机时先恢复出厂设置，然后更改所需的寄存器即可。

**摇杆按键操作**

================    ================    ================
当前模式              操作方式              动作含义          
================    ================    ================
运行模式              向上拨动              切换上个算法
运行模式              向下拨动              切换下个算法
运行模式              向左拨动              拍照（当插入SD时）
运行模式              向右拨动              进入GUI设置模式
运行模式              垂直短按              保存当前模型（部分算法有效）
运行模式              向上长按              放大镜头焦距Zoom
运行模式              向下长按              缩小镜头焦距Zoom
运行模式              向左长按              关闭/开启屏幕
运行模式              向右长按              暂无定义
运行模式              垂直长按              删除所有保存的模型（部分算法有效）

设置模式              向上拨动              切换上一个菜单/控件
设置模式              向下拨动              切换下一个菜单/控件
设置模式              向左拨动              切换上一个设置界面/返回运行模式/
设置模式              向右拨动              切换下一个设置界面
设置模式              垂直短按              进入控件进行参数设置
================    ================    ================

算法设置
****************
* 设置算法ID
    所有算法具有相同的配置寄存器地址以及参数格式，为了区分当前是对哪个算法进行操作，需要先指定算法ID：
    在寄存器0x20-VISION_ID写入算法的ID编号，然后再配置其他算法相关寄存器。

* 设置算法参数Param
    首先需要设置0x23-PARAM_NUM告知传感器一共有几个参数需要读取，然后设置各参数的值。
    算法参数Param共用相同的寄存器地址，算法支持设置多组参数，为了区分当前是对哪组参数进行操作，需要指定参数ID：
    在寄存器0x24-PARAM_ID中写入参数的ID编号，然后再配置其他参数相关的寄存器。

* 开启/关闭算法
    在寄存器0x21-VISIO_CONF1中写入0x01,即可开启算法，写入0x00则关闭算法。

结果读取
****************
* 设置算法ID
    所有算法具有相同的结果寄存器地址以及参数格式，为了区分当前是对哪个算法进行操作，需要先指定算法ID：
    在寄存器0x20-VISION_ID写入算法的ID编号，然后再读取其他算法相关寄存器。

* 读取结果数量
    每帧图像处理完后会将处理结果数量更新至寄存器0x34-RESULT_NUM中，用户可以通过读取该寄存器得知有几个结果待读取。

* 读取算法结果
    图像处理完后会将结果更新至寄存器中，可能有多个结果输出，为了区分当前要读取哪个结果值，需要指定结果ID：
    在寄存器0x24-RESULT_ID写入待读取结果的ID编号，然后再读取相关的结果寄存器。

串口协议
----------------

格式
****************
START | LEN | ADDR | CMD | DATA | CHKSUM | END

========    ========    ================    ========
符号         含义         长度                描述
========    ========    ================    ========
START       帧头         1Byte               表示一个数据包的开始，始终为0xFF
LEN         长度         1Byte               数据包的总长度（字节），包含帧头和帧尾
ADDR        地址         1Byte               设备物理地址
CMD         指令         1Byte               指令代码，详见指令列表
DATA        数据         (LEN-6)Byte         数据内容，相见指令列表
CHKSUM      校验         1Byte               从帧头（含）到DATA数据的所有字节累加求和，进位丢弃
END         帧尾         1Byte               表示一个数据包的结束，始终为0xED
========    ========    ================    ========

数据交互方式
****************
Sentry串口模式下采用应答机制，传感器的数据交互完全由主控设备控制，传感器不会主动向主控发送数据。数据交互时，由主控设备先发送指令帧，然后传感器将会返回一个或多个应答帧，完成一次数据交互。


指令介绍
****************
================    ================    ================
指令代码              名称                描述
================    ================    ================
0x01                SetRegister         设置寄存器
0x02                GetRegister         读取寄存器
0x20                SetParam            设置算法参数
0x21                SetParamGroup       按组设置算法参数
0x22                GetResult           读取算法结果
0x23                GetResultGroup      按组读取算法结果
================    ================    ================

* Param Group 参数组
    一组参数可以表示一个作用域，每组参数最多可包含5个参数值，不同的算法对这5个参数值的含义可能是不同的。
    
    仅有部分算法具有参数设置功能，有的算法还可以设置多组参数，每组参数由ParamID进行标记。
    
    比如颜色识别算法，要设置25个检测区域，则需要写入25组参数
* Param Value 参数值
    每组参数可以由5个参数值来描述，不同算法的参数值的含义并不相同，详见下表

    ================    ========================    ========================    ========================    ========================    ========================
    算法                 Param Value1                Param Value2                Param Value3                Param Value4                Param Value5 
    ================    ========================    ========================    ========================    ========================    ========================
    颜色识别              检测区域中心点x坐标            检测区域中心点y坐标            检测区域宽度w                 检测区域高度h                 无
    色块检测              无                          无                           最小色块宽度w                 最小色块高度h                 待检测的颜色分类标签
    ================    ========================    ========================    ========================    ========================    ========================
* Result Group 结果组
    一组数据表示一个检测结果，每组结果包含5个数据，但不同的算法对这5个数据的含义可能是不同的，部分算法可以返回多个结果，每组检测结果由ResultID进行标记。
* Result Data 结果数据
    ================    ========================    ========================    ========================    ========================    ========================    ========================
    算法                 Result Data1                Result Data1                Result Data3                Result Data4                Result Data5                备注
    ================    ========================    ========================    ========================    ========================    ========================    ========================
    颜色识别              R红色值                      G绿色值                      B蓝色值                      无                          颜色分类标签
    色块检测              中心x坐标                    中心y坐标                     宽度w                       高度h                        颜色分类标签
    线条检测              起点x坐标                    起点y坐标                     终点x坐标                    终点y坐标                     无
    卡片识别              中心x坐标                    中心y坐标                     宽度w                       高度h                        卡片分类标签
    人脸识别              中心x坐标                    中心y坐标                     宽度w                       高度h                        人脸分类标签                  只有训练记忆后人脸数据才有分类标签
    20类物体识别           中心x坐标                    中心y坐标                     宽度w                       高度h                        物体分类标签
    二维码识别            中心x坐标                    中心y坐标                     宽度w                       高度h                        字符数量                      后续结果组为字符数据
    移动物体检测           中心x坐标                    中心y坐标                     宽度w                       高度h                        无
    ================    ========================    ========================    ========================    ========================    ========================    ========================

* 0x01-SetRegister
    描述:设置寄存器，每次只可设置一个寄存器（一个字节）

    指令帧CMD：0x01

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Byte5               Byte6               Byte7           
    ================    ================    ================    ================    ================    ================    ================
    寄存器地址            待写入数据
    ================    ================    ================    ================    ================    ================    ================

    应答帧CMD：0xE0

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Byte5               Byte6               Byte7           
    ================    ================    ================    ================    ================    ================    ================
    0x01                已写入数据
    ================    ================    ================    ================    ================    ================    ================

* 0x02-GetRegister
    描述:读取寄存器，每次只可读取一个寄存器（一个字节）

    指令帧CMD：0x02

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Byte5               Byte6               Byte7           
    ================    ================    ================    ================    ================    ================    ================
    寄存器地址            
    ================    ================    ================    ================    ================    ================    ================

    应答帧CMD：0xE0

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Byte5               Byte6               Byte7           
    ================    ================    ================    ================    ================    ================    ================
    0x02                读取的数据
    ================    ================    ================    ================    ================    ================    ================

* 0x20-SetParam
    描述:设置指定算法同一类型的参数值，可以同时设置多个数据，比如单独设置颜色识别算法10个检测区域的x坐标

    指令帧-0x20

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Byte5               Bytes               Bytes    
    ================    ================    ================    ================    ================    ================    ================
    算法ID               参数类型             起始ParamID1         结束ParamIDn         参数1               参数2                参数n
    ================    ================    ================    ================    ================    ================    ================

    应答帧CMD：0xE0

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Byte5               Byte6               Byte7           
    ================    ================    ================    ================    ================    ================    ================
    0x20                算法ID
    ================    ================    ================    ================    ================    ================    ================

* 0x21-SetParamGroup
    描述:设置指定算法的参数组数据，每个参数组包含5个数据项，比如同时设置颜色识别算法的5个检测区域x，y，w，h信息

    指令帧CMD：0x21

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Bytes               Bytes               Bytes
    ================    ================    ================    ================    ================    ================    ================
    算法ID               起始ParamID1         结束ParamIDn        参数组1              参数组2              参数组n
    ================    ================    ================    ================    ================    ================    ================

    应答帧CMD：0xE0

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Byte5               Byte6               Byte7           
    ================    ================    ================    ================    ================    ================    ================
    0x21                算法ID
    ================    ================    ================    ================    ================    ================    ================

* 0x22-GetResult
    描述:获取指定算法算法的某一类型的检测结果，比如只获取颜色识别的标签数据，而不关心xy坐标

    指令帧CMD：0x22

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Byte5               Bytes               Bytes    
    ================    ================    ================    ================    ================    ================    ================
    算法ID               数据类型             起始ResultID         结束ResultID         
    ================    ================    ================    ================    ================    ================    ================

    因为每个数据帧的最大长度只有255个字节，当检测结果帧数据长度超过此值时，将会产生多个数据帧，当CMD为0xEC时表示中间帧，为0xE0时表示结束帧
    
    应答帧CMD：0xEC或0xE0

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Byte5               Byte6               Bytes           
    ================    ================    ================    ================    ================    ================    ================
    0x22                图像帧号             算法ID               数据类型            起始ResultID1        结束ResultIDn        结果数据
    ================    ================    ================    ================    ================    ================    ================

* 0x23-GetResultGroup
    描述:获取指定算法每组的检测结果，一组检测结果包含5个数据项，比如同时获取颜色识别算法的5个区域的RGB值和分类标签值

    指令帧CMD：0x23

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Byte5               Bytes               Bytes    
    ================    ================    ================    ================    ================    ================    ================
    算法ID               数据类型             起始ResultID         结束ResultID         
    ================    ================    ================    ================    ================    ================    ================

    因为每个数据帧的最大长度只有255个字节，当检测结果帧数据长度超过此值时，将会产生多个数据帧，当CMD为0xEC时表示中间帧，为0xE0时表示结束帧
    
    应答帧CMD：0xEC或0xE0

    ================    ================    ================    ================    ================    ================    ================
    Byte1               Byte2               Byte3               Byte4               Byte5               Byte6               Bytes    
    ================    ================    ================    ================    ================    ================    ================
    0x23                图像帧号             算法ID               起始ResultID1        结束ResultIDn        结果组1              结果组n
    ================    ================    ================    ================    ================    ================    ================


寄存器
---------
balabala




